function parseAndStorage(e,a,t){var n=!1,r=[],s="ls_"+e;return r=t.get(s),null==r&&(r=[]),-1==r.indexOf(a)?(r.push(a),t.put(s,r)):n=!0,n}function parseStorage(e){if(null!=e){var a="";return angular.forEach(e,function(e){a+=e+" OR "}),a=a.slice(0,a.length-4)}}function parseStorageAndSwitch(e,a){if(null!=e){var t="";a=null==a||void 0==a?"OR":"AND",angular.forEach(e,function(e){t+=e+" "+a+" "});var n="OR"===a?4:5;return t=t.slice(0,t.length-n)}}function parseStage(e){if(null!=e){var a="";return angular.forEach(e,function(e){"PRE_A"==e&&(e="pre-A"),"LAST_STAGE"==e&&(e="Last Stage"),"UNKNOWN"==e&&(e="Unknown"),a+=e+" OR "}),a=a.slice(0,a.length-4)}}function parseStageValue(e){if(null!=e){var a="";return angular.forEach(e,function(e){301==e&&(a+="Angle OR "),302==e&&(a+="Pre-A OR "),303==e&&(a+="Serials A OR "),304==e&&(a+="Serials B OR "),305==e&&(a+="Serials C OR "),306==e&&(a+="Serials D OR "),307==e&&(a+="Serials E OR "),308==e&&(a+="Late Stage OR ")}),a=a.slice(0,a.length-4)}}function parseFinance(e){if(null!=e){var a=e.length;return a>9?e=e.substring(0,a-9)+"b":a>6?e=e.substring(0,a-6)+"m":a>3&&(e=e.substring(0,a-3)+"k"),(1e8==e||"100m"==e)&&(e="100m+"),e}}function openModalFilter(e,a,t,n,r,s,l){l=angular.lowercase(l);var i=n.open({animation:a.animationsEnabled,templateUrl:"./views/modal/"+l+"_modal.html",controller:"ModalInstanceCtrl"});i.result.then(function(){r.put("ls_page",1),change(e,a,t,r,s)})}function appendElement(e,a){var t='<div class="search-param label"> '+a+'<i class="fa fa-times close-filter" item-close-filter="'+e+'"></i></div> ';return t}function appendListSearch(e){var a='<div class="list-param label div-tag m-t-sm"  tooltip-placement="top" tooltip="Contains '+e.count+' Companies"select-list="'+e.listId+'">'+e.listName+'<i class="fa fa-plus"></i></div>';return a}function change(e,a,t,n,r){var s=getParams(e,a,t,n,r);$(".filter-selected").children("div").css("display","inline-block"),loadSearchData(e,a,t,n,r,s)}function getParams(e,a,t,n){var r=n.get("ls_change");if(r){a.name=n.get("ls_name"),a.keyword=n.get("ls_keyword"),a.keywordSwitch=n.get("ls_keyword_switch"),a.location=n.get("ls_location"),a.investor=n.get("ls_investor"),a.investorSwitch=n.get("ls_investor_switch"),a.stage=n.get("ls_stage"),a.foundedAfter=n.get("ls_founded_after"),a.foundedBefore=n.get("ls_founded_before"),a.page=n.get("ls_page"),a.stageValue=n.get("ls_stage_value"),e.nameSelected=parseStorage(a.name),e.keywordSelected=parseStorageAndSwitch(a.keyword,a.keywordSwitch),e.locationSelected=parseStorage(a.location),e.investorSelected=parseStorageAndSwitch(a.investor,a.investorSwitch),e.stageSelected=parseStage(a.stage),e.foundedAfter=a.foundedAfter,e.foundedBefore=a.foundedBefore;var s={};s.names=a.name,s.keywords=a.keyword,s.keywordSwitch=a.keywordSwitch,s.locations=a.location,s.investors=a.investor,s.investorSwitch=a.investorSwitch,s.stages=a.stageValue;var l=a.foundedAfter;null!=l&&(l=l.slice(6,10)+"-"+l.slice(0,2)+"-"+l.slice(3,5));var i=a.foundedBefore;null!=i&&(i=i.slice(6,10)+"-"+i.slice(0,2)+"-"+i.slice(3,5)),s.foundedAfter=l,s.foundedBefore=i,s.page=null==a.page?1:a.page;var o=angular.toJson(s);return console.log(o),n.put("ls_params",o),n.remove("ls_change"),o}}function loadSearchData(e,a,t,n,r,s){var l={method:"POST",url:"/api/search/company",headers:{"Content-Type":"application/json"},data:s,responseType:"json"},i=[];t(l).success(function(t){e.total=t.total,a.totalPage=t.total/100,i=t.companyIds}).then(function(){if(0==i.length){var e=[];return void r.newData(e)}var a={method:"POST",url:"./api/company/getCompanies",params:{ids:i}};t(a).success(function(e){r.newData(e.companyList)})})}function parseSearchParams(e,a){a.date=e("date")(a.createTime,"yyyy-MM-dd HH:mm:ss"),a.params=angular.fromJson(a.searchParams),a.params.names=parseStorage(a.params.names),a.params.keywords=parseStorage(a.params.keywords),a.params.locations=parseStorageAndSwitch(a.params.locations,a.params.keywordSwitch),a.params.investors=parseStorageAndSwitch(a.params.investors,a.params.investorSwitch),a.params.stages=parseStageValue(a.params.stages)}function keyUpOrDown(e,a){var t=e.next().children();if(0!=t.length){var n,r=t.first(),s=t.last(),l=!1;return t.each(function(){$(this).hasClass("result-select")&&(n="up"==a?$(this).children().text()==r.children().text()?s:$(this).prev():$(this).children().text()==s.children().text()?r:$(this).next(),l=!0)}),l||(n="up"==a?e.parent().children("span").last().children().last():e.parent().children("span").first().children().last()),"down"!=a||l||(n=r),n.addClass("result-select"),n.siblings().removeClass("result-select"),e.val(n.children().text()),n}}function autoComplete(e,a,t,n,r){var s=a.text().trim();if(console.log(s),void 0!=s&&null!=s&&""!=s){var l=parseAndStorage(t,s,n);if(!l){var i=r(appendElement(t,s))(e);a.parent().parent().children("span").first().append(i),n.put("ls_change",!0),$("#input-location").val(""),$("#input-keyword").val(""),$("#input-investor").val(""),$("#input-name").val(""),a.parent().css("display","none"),$("#div-"+t).is(":visible")||$("#div-"+t).css("display","inline-block")}}}function deleteOperation(e,a,t,n){var r="./api/user/";"delete"==t&&(r+="search/delete"),"deleteOwner"==t&&(r+="list/deleteOwner");var s={method:"delete",url:r,params:{id:n}};e(s).success(function(){var e="<div class='div-opearte-add pull-right'><i class='fa fa-check'></i><span>Delete Success</span></div>",t=a.offset().top;a.parent().parent().parent().parent().append(e),$(".div-opearte-add").css({top:t-23+"px",right:"3%",position:"absolute"}).fadeIn(500).delay(1e3).fadeOut(500),a.parent().parent().parent().fadeOut(1e3)})}function comfirm(e){var a=e.open({templateUrl:"./views/modal/user/comfirm_modal.html",controller:"BasicModalInstanceCtrl",resolve:{template:function(){return"comfirm"}}});return a}function alertDiv(e,a){var t="<div class='growl-container'><p>"+e+"</p><p>"+a+".</p></div>";$("#page-wrapper").append(t),$(".growl-container").delay(3e3).fadeOut(500)}function alertDeleteDiv(e,a){var t="<div class='growl-container'><p>"+e+"</p><p>"+a+".</p></div>";$("#page-wrapper").append(t),$(".growl-container").delay(3e3).fadeOut(500)}function doSearch(e,a,t,n,r,s,l,i){r.remove("ls_name"),r.remove("ls_keyword"),r.remove("ls_keyword_switch"),r.remove("ls_location"),r.remove("ls_investor"),r.remove("ls_investor_switch"),r.remove("ls_stage"),r.remove("ls_founded_after"),r.remove("ls_founded_before");var o=parseAndStorage(i,l,r);o||($("#top-search").val(""),r.put("ls_change",!0),change(e,a,t,r,s),n.path("/index/search"))}function getAllList(e,a,t,n){a.get("./api/user/list/getAll").success(function(a){e.allList=a.userList,e.total=e.allList.length}).then(function(){var r=[];if(t.get("ls_feature")){var s=n.absUrl().split("?")[1];(null==s||""==s)&&n.path("/index/my_list"),a.get("./api/user/list/getFeature?companyId="+s).success(function(e){r=e.userList}).then(function(){t.remove("ls_feature")})}else angular.forEach(e.allList,function(e,a){10>a&&this.push(e)},r);e.userList=r,e.userList.length>0&&$("#list-in-modal").show()})}